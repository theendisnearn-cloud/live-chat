<!DOCTYPE html>
<html>
<head>
  <title>Support Dashboard</title>
</head>
<body>
  <h2>Support Dashboard</h2>

  <div id="log" style="border:1px solid #ccc;height:200px;overflow:auto;"></div>

  <input id="session" placeholder="Session ID" />
  <input id="reply" placeholder="Type reply..." />
  <button id="send">Send</button>

  <script>
  function getTime(ts = Date.now()) {
    const d = new Date(ts);
    return d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
  }

  const socket = new WebSocket("wss://live-chat-4i3s.onrender.com");

  socket.onopen = () => {
    console.log("âœ… Support connected to WebSocket");
    socket.send(JSON.stringify({ type: "support_join" }));
  };

  socket.onmessage = (event) => {
    const data = JSON.parse(event.data);
    console.log("ðŸ“© Received:", data);

    if (data.type === "user_message") {
      document.getElementById("log").innerHTML += `
        <div style="margin-bottom:10px;">
          <b>Customer</b> (${data.sessionId})<br>
          ${data.text}<br>
          <small>${getTime(data.time)}</small>
        </div>
      `;

      document.getElementById("session").value = data.sessionId;
    }
  };

  document.getElementById("send").onclick = () => {
    const text = document.getElementById("reply").value;
    const sessionId = document.getElementById("session").value;

    socket.send(JSON.stringify({
      type: "support_message",
      sessionId,
      text
    }));

    document.getElementById("log").innerHTML += `
      <div style="margin-bottom:10px;text-align:right;">
        <b>Support</b><br>
        ${text}<br>
        <small>${getTime()}</small>
      </div>
    `;

    document.getElementById("reply").value = "";
  };
</script>
</body>

</html>
